<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Administrar Distritos</title>
    <!-- Estilos CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Estilos personalizados -->
    <style>
        .container {
            max-width: 800px;
        }
        .btn-delete {
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2 class="text-center mb-4">Administrar Distritos</h2>

    <!-- Botón para mostrar/ocultar formulario de registro -->
    <button id="btnMostrarFormulario" class="btn btn-primary mb-3">Registrar Nuevo Distrito</button>

    <!-- Formulario para registrar distrito -->
    <div id="formularioRegistro" style="display: none;">
        <h3 class="mb-3">Registrar Distrito</h3>
        <form th:action="@{/district/registrarDistrito}" method="post">
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre:</label>
                <input type="text" class="form-control" id="nombre" name="name" required>
            </div>
            <div class="mb-3">
                <label for="canton" class="form-label">Cantón:</label>
                <select id="canton" class="form-select" name="idCanton" required>
                    <option th:each="canton : ${cantones}" th:value="${canton.id}" th:text="${canton.name}"></option>
                </select>
            </div>
            <button type="submit" class="btn btn-success">Registrar Distrito</button>
        </form>
    </div>

    <!-- Lista de distritos existentes -->
    <div th:if="${not #lists.isEmpty(distritos)}">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th scope="col">Nombre</th>
                    <th scope="col">Cantón</th>
                    <th scope="col">Status</th>
                    <th scope="col">Opciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="district : ${distritos}">
                    <td th:text="${district.name}"></td>
                    <td th:text="${district.getIdCanton() != null ? district.getIdCanton().getName() : ''}"></td>
                    <td th:text="${district.status == 1 ? 'Activo' : 'Inactivo'}"></td>
                    <td>
                        <div class="d-flex">
                            <button type="button" class="btn btn-primary btn-sm me-2">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-danger btn-sm btn-delete" th:attr="data-url=@{/district/eliminarDistrict(id=${district.id})}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Mensaje cuando no hay registros -->
    <div th:if="${#lists.isEmpty(distritos)}">
        <p class="text-center">No se encontraron registros para mostrar.</p>
    </div>
</div>

<!-- Scripts JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<!-- Lógica para mostrar/ocultar formulario y confirmar eliminación -->
<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function () {
        // Mostrar/ocultar formulario de registro
        document.getElementById('btnMostrarFormulario').addEventListener('click', function () {
            document.getElementById('formularioRegistro').style.display = 'block';
        });

        // Confirmar eliminación
        document.querySelectorAll('.btn-delete').forEach(button => {
            button.addEventListener('click', function (event) {
                event.preventDefault();
                Swal.fire({
                    title: '¿Estás seguro?',
                    text: 'Esta acción no se puede revertir',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Eliminar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = button.getAttribute('data-url');
                    }
                });
            });
        });
    });
</script>

</body>
</html>
